<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Peter Bloomingdale">
<meta name="dcterms.date" content="2023-12-09">

<title>Peter’s Website - PMxGPT: A specialized GPT model for Pharmacometrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GPQF9TMB2F"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-GPQF9TMB2F', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Peter’s Website</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About Me</span></a>
  </li>  
</ul>
            <div class="quarto-toggle-container">
                <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
            </div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">PMxGPT: A specialized GPT model for Pharmacometrics</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">AI/ML</div>
                <div class="quarto-category">Pharmacometrics</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Peter Bloomingdale </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 9, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TLDR</a></li>
  <li><a href="#model-customization" id="toc-model-customization" class="nav-link" data-scroll-target="#model-customization">Model Customization</a>
  <ul class="collapse">
  <li><a href="#brief-introduction-to-llm-optimization" id="toc-brief-introduction-to-llm-optimization" class="nav-link" data-scroll-target="#brief-introduction-to-llm-optimization">Brief Introduction to LLM Optimization</a></li>
  <li><a href="#prompt-engineering" id="toc-prompt-engineering" class="nav-link" data-scroll-target="#prompt-engineering">Prompt Engineering</a></li>
  <li><a href="#uploading-documents" id="toc-uploading-documents" class="nav-link" data-scroll-target="#uploading-documents">Uploading Documents</a></li>
  </ul></li>
  <li><a href="#pmxgpt-applications" id="toc-pmxgpt-applications" class="nav-link" data-scroll-target="#pmxgpt-applications">PMxGPT Applications</a>
  <ul class="collapse">
  <li><a href="#area-under-the-curve-auc" id="toc-area-under-the-curve-auc" class="nav-link" data-scroll-target="#area-under-the-curve-auc">Area Under the Curve (AUC)</a></li>
  <li><a href="#obtaining-physiological-parameters-values" id="toc-obtaining-physiological-parameters-values" class="nav-link" data-scroll-target="#obtaining-physiological-parameters-values">Obtaining Physiological Parameters Values</a></li>
  <li><a href="#generating-pbpk-model-code" id="toc-generating-pbpk-model-code" class="nav-link" data-scroll-target="#generating-pbpk-model-code">Generating PBPK Model Code</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TLDR</h2>
<p>Well it’s not banana bread at work, but it’s the first version of a domain-specific GPT for pharmacometrics. Hell yeah!</p>
<p>Last month, OpenAI released <a href="https://openai.com/blog/introducing-gpts">‘GPTs’</a>, which enables users to create custom version of ChatGPT for specialized purposes. Essentially, custom versions of ChatGPT can be generated by simply conversing with ChatGPTs ‘Create a GPT’. You can further configure the model through adding instructions (prompt engineering) and uploading documents to create a knowledge based for the model to search through. In order to use custom built GPTs you currently need a ChatGPT plus subscription.</p>
<p>To exemplify the power of this feature I created a custom version of ChatGPT for pharmacometrics called <strong>PMxGPT</strong> and provided a use case for assisting me with the development of a brain PBPK model.</p>
<p>PMxGPT was useful for answering questions on brain PBPK modeling and supporting model development through providing parameter values and code. However, there is clear room for improvement.</p>
<p>The key to a usable custom LLM for pharmacometrics will be the high quality input data, which is currently lacking in the field. Standardization of model code, parameter/equation nomenclature, and adequate model documentation are all paramount.</p>
</section>
<section id="model-customization" class="level2">
<h2 class="anchored" data-anchor-id="model-customization">Model Customization</h2>
<section id="brief-introduction-to-llm-optimization" class="level3">
<h3 class="anchored" data-anchor-id="brief-introduction-to-llm-optimization">Brief Introduction to LLM Optimization</h3>
<p>There are different approaches that can be used to optimize LLMs. These can be broadly categorized as:</p>
<ol type="1">
<li><strong>Prompt Engineering</strong> - Tailoring the input/prompt to guide the model towards generating a desired output</li>
<li><strong>Retrieval Augmented Generation (RAG)</strong> - Giving the model additional information, external from the training/development process, to retrieve to enrich responses</li>
<li><strong>Fine-Tuning</strong> - Updating pre-trained language model parameters with additional data to improve accuracy on specific tasks</li>
</ol>
<p>From easy to hard these can be arranged from prompt engineering to RAG to fine-tuning. If you can accomplish your goals through prompt engineering and RAG (or other data retrieval methods), then you do not need to perform fine-tuning. These methods can be split into, <em>context optimization</em> (what the model needs to know) and LLM optimization (*how the model needs to act). This is nicely described further in the following <a href="https://youtu.be/ahnGLM-RC1Y?si=d4jqU-yLgokfzRpT&amp;t=171">YouTube Video</a>.</p>
<p>For creating custom GPTs, you are able to use <strong>prompt engineering</strong> and <strong>upload documents</strong> to create a searchable knowledge base.</p>
</section>
<section id="prompt-engineering" class="level3">
<h3 class="anchored" data-anchor-id="prompt-engineering">Prompt Engineering</h3>
<p>A lot can be accomplished through prompt engineering alone. Here is the prompt that I have used in the Instructions field within Configure:</p>
<blockquote class="blockquote">
<p>Your role is to assist pharmacometricians, especially in the context of drug discovery and development. You will provide insights on pharmacokinetics, pharmacodynamics, mathematical modeling, and coding. Your expertise includes nonlinear mixed effects modeling for population analyses, crucial in pharmacometrics.</p>
<p>You are an expert using pharmacometrics and systems pharmacology specific software, NONMEM, Monolix, Phoenix WinNonlin, Simcyp Simulator, GastroPlus, PK-Sim &amp; MoBi (Open Systems Pharmacology Suite), MATLAB with SimBiology, and can guide users in conducting analyses using these tools.</p>
<p>Avoid providing medical advice or specific patient recommendations. Stick to general principles, modeling techniques, and software guidance. Avoid making predictions about drug approval or regulatory decisions.</p>
<p>Provide clear, concise, and accurate explanations, using technical jargon appropriately. For queries outside your scope or too specific to individual cases, clarify your limitations. Ask for clarification on ambiguous or incomplete queries to ensure accurate responses.</p>
</blockquote>
</section>
<section id="uploading-documents" class="level3">
<h3 class="anchored" data-anchor-id="uploading-documents">Uploading Documents</h3>
<p>Now its unclear exactly how the GPT uses the uploaded documents. If you ask PMxGPT how it uses the documents, this is the answer:</p>
<p><img src="PMxGPT_Output1.png" class="img-fluid"></p>
<p>In short, RAG or fine-tuning is not being performed using the uploaded documents. After testing the functionality, the ability for PMxGPT to search through the uploaded documents was slow and limited. The model faced difficulties cross-referencing information between documents to come up with an accurate output, which is further exemplified in the application section.</p>
<p>For this version of PMxGPT and this blog post, I only uploaded the manuscript and supplementary materials from <a href="https://link.springer.com/article/10.1007/s10928-021-09776-7">Minimal brain PBPK model to support the preclinical and clinical development of antibody therapeutics for CNS diseases</a>.</p>
</section>
</section>
<section id="pmxgpt-applications" class="level2">
<h2 class="anchored" data-anchor-id="pmxgpt-applications">PMxGPT Applications</h2>
<section id="area-under-the-curve-auc" class="level3">
<h3 class="anchored" data-anchor-id="area-under-the-curve-auc">Area Under the Curve (AUC)</h3>
<p>Asking <strong><em>‘What is AUC?’</em></strong> is cute example highlighting the difference in output between a base pre-trained LLM, such as GPT4, and a custom domain-specific LLM, such as PMxGPT.</p>
<p><img src="ChatGPT_AUC.png" class="img-fluid"></p>
<p><img src="PMxGPT_AUC.png" class="img-fluid"></p>
<p>We can see from the above figures that when we ask ChatGPT what is AUC, we get a response about AUC as a metric in machine learning specifically on the receiver operating characteristic (ROC) curve. This answer is <strong>incorrect</strong> in the context of pharmacometrics.</p>
<p>When we ask PMxGPT what is AUC, we get an answer that it refers to the area under the plasma concentration-time curve a metric of drug exposure in the body over time, which is <strong>correct</strong>. Improving the context by engineering the prompt/instructions, we have steered our version of ChatGPT (PMxGPT) towards finding the correct information.</p>
</section>
<section id="obtaining-physiological-parameters-values" class="level3">
<h3 class="anchored" data-anchor-id="obtaining-physiological-parameters-values">Obtaining Physiological Parameters Values</h3>
<p>This could be useful. Imagine just asking an LLM what is the volume of tissue <strong><em>X</em></strong> or the concentration of target <strong><em>Y</em></strong>.</p>
<p>We asked PMxGPT, <strong><em>‘What is the Brain CSF Volume in Human and Rat?’</em></strong>.</p>
<p><img src="PMxGPT_BrainVolume.png" class="img-fluid"></p>
<p>Unfortunately, we had to guide the model to a specific document to search through. This can be solved by preemptively guiding the model where to search by adding the following line to our initial prompt:</p>
<blockquote class="blockquote">
<p>When asked about a parameter value on brain physiology or brain PBPK model, search the parameter table (Table 1) in the uploaded manuscript file (Final Brain PBPK Model Reduction to mPBPK v5.docx)</p>
</blockquote>
<p>Now we get the correct answer the first time when asking PMxGPT with the updated prompt, <strong><em>‘What is the Brain CSF Volume in Human and Rat?’</em></strong>:</p>
<p><img src="PMxGPT_BrainVolume2.png" class="img-fluid"></p>
<p>However, if we have to customize our prompt everytime we add a new model to our PMxGPT knowledge base that would be pretty annoying and inefficient. This hopefully could be solved through other mechanisms. Either improving the LLM (RAG/fine-tuning) or the data source (improved/standardized model documentation and/or entering parameter values in relational databases).</p>
</section>
<section id="generating-pbpk-model-code" class="level3">
<h3 class="anchored" data-anchor-id="generating-pbpk-model-code">Generating PBPK Model Code</h3>
<p>Lets see if this model can generate code for a brain PBPK model and lets compare it to base ChatGPT 4.</p>
<p>We asked, <strong>‘Generate code for a minimal brain PBPK model in MATLAB’:</strong></p>
<section id="chatgpt4-response" class="level4">
<h4 class="anchored" data-anchor-id="chatgpt4-response">ChatGPT4 Response</h4>
<p>Creating a minimal physiologically based pharmacokinetic (PBPK) model for the brain in MATLAB involves several steps. This code will provide a basic framework, which you can then expand and refine based on your specific needs and data. The model will include compartments for blood and brain tissue, and will simulate the distribution of a substance between these compartments.</p>
<p>Here is a simple MATLAB script to start with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="va">pbpk_brain_model</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Define Parameters</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Q_brain</span> <span class="op">=</span> <span class="fl">0.17</span><span class="op">;</span> <span class="co">% Blood flow to brain (L/min)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">V_brain</span> <span class="op">=</span> <span class="fl">1.4</span><span class="op">;</span> <span class="co">% Volume of brain (L)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">P_bbb</span> <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span> <span class="co">% Permeability of blood-brain barrier (L/min)</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">K_met</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span> <span class="co">% Metabolic rate constant in brain (1/min)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Initial Conditions</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_blood_initial</span> <span class="op">=</span> <span class="fl">1</span><span class="op">;</span> <span class="co">% Initial concentration in blood (mg/L)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_brain_initial</span> <span class="op">=</span> <span class="fl">0</span><span class="op">;</span> <span class="co">% Initial concentration in brain (mg/L)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">initial_conditions</span> <span class="op">=</span> [<span class="va">C_blood_initial</span><span class="op">,</span> <span class="va">C_brain_initial</span>]<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Time Span</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">tspan</span> <span class="op">=</span> [<span class="fl">0</span> <span class="fl">60</span>]<span class="op">;</span> <span class="co">% Time span of simulation (min)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Solve ODEs</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    [<span class="va">t</span><span class="op">,</span> <span class="va">C</span>] <span class="op">=</span> <span class="va">ode45</span>(<span class="op">@</span><span class="va">pbpk_odes</span><span class="op">,</span> <span class="va">tspan</span><span class="op">,</span> <span class="va">initial_conditions</span>)<span class="op">;</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Plot Results</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">figure</span><span class="op">;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">plot</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span>(<span class="op">:,</span><span class="fl">1</span>)<span class="op">,</span> <span class="ss">'b-'</span><span class="op">,</span> <span class="va">t</span><span class="op">,</span> <span class="va">C</span>(<span class="op">:,</span><span class="fl">2</span>)<span class="op">,</span> <span class="ss">'r-'</span>)<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">xlabel</span>(<span class="ss">'Time (min)'</span>)<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="va">ylabel</span>(<span class="ss">'Concentration (mg/L)'</span>)<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="va">legend</span>(<span class="ss">'Blood'</span><span class="op">,</span> <span class="ss">'Brain'</span>)<span class="op">;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="va">title</span>(<span class="ss">'Minimal Brain PBPK Model'</span>)<span class="op">;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">% ODEs Function</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="va">dCdt</span> <span class="op">=</span> <span class="va">pbpk_odes</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">C_blood</span> <span class="op">=</span> <span class="va">C</span>(<span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="va">C_brain</span> <span class="op">=</span> <span class="va">C</span>(<span class="fl">2</span>)<span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">% ODEs</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="va">dCdt_blood</span> <span class="op">=</span> <span class="op">-</span><span class="va">P_bbb</span> <span class="op">*</span> (<span class="va">C_blood</span> <span class="op">-</span> <span class="va">C_brain</span>) <span class="op">-</span> <span class="va">Q_brain</span><span class="op">/</span><span class="va">V_brain</span> <span class="op">*</span> <span class="va">C_blood</span><span class="op">;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="va">dCdt_brain</span> <span class="op">=</span> <span class="va">P_bbb</span> <span class="op">*</span> (<span class="va">C_blood</span> <span class="op">-</span> <span class="va">C_brain</span>) <span class="op">-</span> <span class="va">K_met</span> <span class="op">*</span> <span class="va">C_brain</span><span class="op">;</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="va">dCdt</span> <span class="op">=</span> [<span class="va">dCdt_blood</span><span class="op">;</span> <span class="va">dCdt_brain</span>]<span class="op">;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Parameters</strong>: These are constants like blood flow (<code>Q_brain</code>), brain volume (<code>V_brain</code>), blood-brain barrier permeability (<code>P_bbb</code>), and metabolic rate (<code>K_met</code>). You should adjust these based on your specific case.</li>
<li><strong>Initial Conditions</strong>: Set the starting concentrations in the blood and brain.</li>
<li><strong>ODEs</strong>: The differential equations represent the rate of change of the substance concentration in each compartment.</li>
<li><strong>Solver</strong>: MATLAB’s <code>ode45</code> function is used to solve the ordinary differential equations (ODEs) over the defined time span.</li>
<li><strong>Plotting</strong>: The results are plotted to visualize the concentration changes over time.</li>
</ul>
<p>To run the model, you just need to call the function <code>pbpk_brain_model</code> in MATLAB.</p>
<p>This model is quite basic and many aspects like additional compartments, more complex kinetics, or different routes of administration can be added to make it more comprehensive. Be sure to validate the model with experimental or literature data to ensure its accuracy for your specific application.</p>
</section>
<section id="pmxgpt-response" class="level4">
<h4 class="anchored" data-anchor-id="pmxgpt-response">PMxGPT Response</h4>
<p>Creating a minimal brain physiologically based pharmacokinetic (PBPK) model in MATLAB involves several steps. The process includes defining the compartments of the model, writing differential equations to represent the pharmacokinetics in each compartment, and implementing the model in MATLAB code. I’ll provide you with a basic framework, which you can expand based on your specific requirements.</p>
<ol type="1">
<li><p><strong>Define the Compartments</strong>: For a minimal brain PBPK model, let’s consider the plasma, brain tissue, and brain extracellular fluid (ECF) as the primary compartments.</p></li>
<li><p><strong>Differential Equations</strong>: Write equations based on mass balance principles that describe the drug concentration changes over time in each compartment. These will include parameters like blood flow rates, partition coefficients, and clearance rates.</p></li>
<li><p><strong>MATLAB Implementation</strong>: Translate the model into MATLAB code, including the differential equations and a solver like <code>ode45</code> for solving these equations.</p></li>
</ol>
<p>Here’s a basic structure for such a MATLAB model:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode matlab code-with-copy"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="va">mPBPK_brain_minimal</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Define Parameters</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">Q_brain</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Blood flow to the brain</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">V_brain</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Volume of the brain tissue</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">V_plasma</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Volume of the plasma</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">CL_brain</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Clearance from the brain</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">P_brain</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Partition coefficient for brain</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Initial Conditions</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_plasma_initial</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Initial concentration in plasma</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_brain_initial</span> <span class="op">=</span> <span class="op">...;</span> <span class="co">% Initial concentration in brain</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Time Span</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">tspan</span> <span class="op">=</span> [<span class="fl">0</span><span class="op">,</span> <span class="fl">24</span>]<span class="op">;</span> <span class="co">% Time span for the simulation (e.g., 24 hours)</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Solve ODEs</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    [<span class="va">t</span><span class="op">,</span> <span class="va">C</span>] <span class="op">=</span> <span class="va">ode45</span>(<span class="op">@</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span>) <span class="va">modelEquations</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span><span class="op">,</span> <span class="va">Q_brain</span><span class="op">,</span> <span class="va">V_brain</span><span class="op">,</span> <span class="va">V_plasma</span><span class="op">,</span> <span class="va">CL_brain</span><span class="op">,</span> <span class="va">P_brain</span>)<span class="op">,</span> <span class="va">tspan</span><span class="op">,</span> [<span class="va">C_plasma_initial</span><span class="op">,</span> <span class="va">C_brain_initial</span>])<span class="op">;</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Plot Results</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">plot</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span>)<span class="op">;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="va">legend</span>(<span class="ss">'Plasma Concentration'</span><span class="op">,</span> <span class="ss">'Brain Concentration'</span>)<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="va">xlabel</span>(<span class="ss">'Time (hours)'</span>)<span class="op">;</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="va">ylabel</span>(<span class="ss">'Concentration'</span>)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="va">title</span>(<span class="ss">'Minimal Brain PBPK Model'</span>)<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="va">dCdt</span> <span class="op">=</span> <span class="va">modelEquations</span>(<span class="va">t</span><span class="op">,</span> <span class="va">C</span><span class="op">,</span> <span class="va">Q_brain</span><span class="op">,</span> <span class="va">V_brain</span><span class="op">,</span> <span class="va">V_plasma</span><span class="op">,</span> <span class="va">CL_brain</span><span class="op">,</span> <span class="va">P_brain</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_plasma</span> <span class="op">=</span> <span class="va">C</span>(<span class="fl">1</span>)<span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">C_brain</span> <span class="op">=</span> <span class="va">C</span>(<span class="fl">2</span>)<span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Differential Equations</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="va">dC_plasma_dt</span> <span class="op">=</span> <span class="op">-</span><span class="va">Q_brain</span><span class="op">/</span><span class="va">V_plasma</span> <span class="op">*</span> <span class="va">C_plasma</span> <span class="op">+</span> <span class="va">Q_brain</span><span class="op">/</span><span class="va">V_brain</span> <span class="op">*</span> <span class="va">C_brain</span><span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="va">dC_brain_dt</span> <span class="op">=</span> <span class="va">Q_brain</span><span class="op">/</span><span class="va">V_plasma</span> <span class="op">*</span> <span class="va">C_plasma</span> <span class="op">-</span> (<span class="va">Q_brain</span><span class="op">/</span><span class="va">V_brain</span> <span class="op">+</span> <span class="va">CL_brain</span><span class="op">/</span><span class="va">V_brain</span>) <span class="op">*</span> <span class="va">C_brain</span><span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">% Return derivatives</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="va">dCdt</span> <span class="op">=</span> [<span class="va">dC_plasma_dt</span><span class="op">;</span> <span class="va">dC_brain_dt</span>]<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>Replace the <code>...</code> with actual parameter values based on your model’s requirements.</li>
<li>The <code>modelEquations</code> function defines the differential equations. The equations should be adapted based on your specific model and parameters.</li>
<li>This is a simplified model. For more complex models, additional compartments and processes (like metabolism, active transport, etc.) should be incorporated.</li>
</ul>
<p>This code provides a starting point. You should adjust and expand it according to the specifics of your brain PBPK model, including any specific data or parameters you have.</p>
</section>
<section id="commentary" class="level4">
<h4 class="anchored" data-anchor-id="commentary">Commentary</h4>
<p>Overall, the structure of the brain PBPK model code between ChatGPT and PMxGPT is very similar. There are some differences in the equations and nomenclature. Both models are two compartment models, where the peripheral compartment is the brain.</p>
<p><strong>ChatGPTs</strong> version is <strong>incorrect</strong> as there is distribution from blood, <strong><code>- Q_brain/V_brain * C_blood</code></strong>, but this piece is not included in the brain differential equation. The only distibution between the plasma and brain is covered by the rate of permeability of the blood-brain barrier (BBB),<strong><code>P_bbb * (C_blood - C_brain)</code></strong>, which is a simplified representation. Typically, the correct physiological representation would be to have distribution of drug to the brain vascular space and then from the brain vascular space drug crossing the BBB. The other <strong>major</strong> problem is that there are dimensionality issues with this model. Note that the units of <code>P_bbb</code> and <code>K_met</code> are <strong>L/min</strong> and <strong>1/min</strong>, respectively. You can clearly see the dimensionality issue in this equation:</p>
<blockquote class="blockquote">
<p><code>dCdt_brain = P_bbb * (C_blood - C_brain) - K_met * C_brain</code></p>
<p>Concentration/Time = <strong>Volume/Time</strong> * Mass/Volume - <strong>1/Time</strong> * Mass/Volume</p>
<p>Concentration/Time = <strong>Mass/Time</strong> - <strong>Concentration/Time</strong></p>
</blockquote>
<p><strong>PMxGPTs</strong> version is generally <strong>correct</strong>, however the model is very simplified. There would be debate whether or not this is a physiologically-based pharmacokinetic (PBPK) model. As this is essentially just a two compartment model parameterized with physiological values. Technically, I would consider it a physiologically model as the parameters are representated/constrained to physiology. The parameters do not have units in the comments, but assuming that flows and clearances are <em>volume/time</em>, the dimensonality of the equations are correct. <code>P_brain</code> was defined as a parameter, but it was never used in the model equations. The model only included equations for plasma and brain, where in the initial description/response it said <strong><em>‘plasma, brain tissue, and brain extracellular fluid (ECF) as the primary compartments’</em></strong>, so there is a discrepency between what it said and the code it produced.</p>
<p>Both models include elimination from the brain compartment, but there is no elimination from the central compartments.</p>
</section>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>This work developing/evaulating PMxGPT provides a proof-of-concept for the development and utility of a domain-specific LLM for pharmacometrics. Being able to ask the model what is the value of a parameter and having it spit out an accurate response could be a huge time savings. I was surprised how well base ChatGPT was at providing the CSF volume in humans and rats. I think there is a nice opporunity to provide LLMs with parameter values that can be quickly retrieved. However, being able to link back to the original source and calculations is crucial. Therefore, I cannot stress enough the importance of good model documentation (e.g., simple standarized modern method: <a href="https://github.com/PeterBloomingdale/moDoc">MoDoc</a>). Code generation was nice, but it did not have a significant advantage over the base model. I view these LLMs as educational and productivity tools. Pharmacometricians expertise is still required for the implementation of the PK-PD models.</p>
<p>There are many limitations. PMxGPT was developed using OpenAIs GPTs feature and was able to access only a single model in its knowledge base. Further work could improve upon this model by collecting additional data/models, standarizing the training data (formating model code in a specific way and parameter nomenclature), and implementing additional LLM optimization techniques. This should hopefully reduce potential hallucinations and provide reliable high-quality outputs.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright © 2023 PeterBloomingdale.com  
  </li>  
</ul>
      </div>
  </div>
</footer>



</body></html>